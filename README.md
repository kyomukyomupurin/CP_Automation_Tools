# CP_Automation_Tools
Automation tools for competitive programming. 

競プロでサンプル入出力の取得、サンプルのチェック、提出等を自動化するツール

パスの扱いは Linux 環境を想定

## 機能

- ログイン
- サンプル入出力のダウンロード
- サンプルが合うかチェック
- 提出
- 提出結果の取得

## 対応サイト

- AtCoder
- Codeforces(まだ)
- LeetCode(まだ)

## 実装メモ

### AtCoder

#### コンテスト情報

- URL の形式 : https://atcoder.jp/contests/{contest}

- 問題数を取得するのが地味にむずい
  - 6 問で決め打ちでもあまり困らないかも？

#### サンプル入出力の取得

- URL の形式 : https://atcoder.jp/contests/{contest}/tasks/{contest}_{id}

- 文字列 {contest} に ```-``` が含まれてるときは {contest}_{id} の部分では ```-``` を ```_``` に置換する必要がある
  - 例 : https://atcoder.jp/contests/m-solutions2020/tasks/m_solutions2020_a
  - ```f"contest.replace("-", "_")"``` と書くと " と " の間でパースされてエラーになるので ```replace()``` の中はシングルクォーテーションで書く必要がある(最初詰まった)

- ABC 級と ARC 級の企業コンが同時開催されてると URL と id の規則性がちょっと複雑

- ```id``` は 6 問なら ```a-f```

- 太古の問題は ```a-f``` の部分が ```1-4``` だったりする
  - つらい
  - 対策 : 太古の問題は、解かない

- h3 タグで "Sample Input", "Sample Output" の直後の ```pre``` タグで囲まれた部分に入力・出力があるのでそれを抜く
  - 太古のコンテストだと英語版が用意されていなくて "入力例"、"出力例" を見つけて抜く必要がある
  - とはいえ、ソースコードに日本語を書くのは気が進まない
  - 対策 : 太古の問題は、解かない

- "Output" の項目で ```1000000007``` か ```998244353``` が含まれていた場合は modint を貼ってあるテンプレートを使う

- 出力が小数になる問題
  - "absolute or relative error" というフレーズが問題文に含まれているかどうかで判断する

#### サンプルのチェック

- 余分な空白、改行は許容してチェックする必要がある
  - 行ごとにチェック
  - 各行の先頭・末尾の余分な空白は許容
  - 注意 : 空白の代わりに改行、または改行の代わりに空白を出力することは**許容しない**
  - 注意 : 出力の各行では余分な空白を**許容している**ので出力が空白の含まれる文字列(```"Hello,     Wor  ld"``` とか)になるような問題では正しくジャッジができない(あまりそのような問題を見た記憶はないが)

- 複数の出力が正解になり得るような問題
  - 対応できないので、自分で出力を眺めて確認する

- 出力が浮動小数点数になる問題
  - スクレイピングの際に許容誤差の情報も抜いておく
  - 抜いた情報を別ファイル(```allowable_error.txt```)に書き出しておく

- ターミナル起動後初回のコンパイルが遅いので、サンプルダウンロード中に非同期でコンパイルを実行しておく

- 実行時間制限はローカルで 3 秒で決め打ちしている
  - 自分の環境はジャッジサーバよりも遅い
  - 真面目に速度差を計測していないので、3 は適当な値

#### ログインと提出

- ```requests.Session()``` でできる

- csrf token はセキュリティのためのワンタイムトークン(Cookie とは別物)

- ログイン時に Cookie を取得してローカルに保存しておく(有効期限は半年くらい？)

#### TO DO

優先度 1~5

- 実行時間制限の取得(1)

- 出力が小数かどうかの判断を書き直す(3)
  - 稀に "absolute or relative error" というフレーズが無いことがあるっぽい

- バイナリ提出機能の実装(3)

## 使い方

### AtCoder

以下、python の実行コマンドは ```python3``` で統一しているがこれは手元の環境に応じて適切なものを使うこと(ソースコードは Python3.8 以降を想定して書かれている)

- ログイン
  - ```python3 login.py```
  - ユーザ名とパスワードを尋ねられるので入力する
  - "Successfully logged in as ~~" というメッセージが表示されたら成功

- サンプル入出力のダウンロード
  - 事前に ```.template/template.cc``` にテンプレートとして使いたいファイルを配置しておく
    - このとき配置するテンプレートはコンパイル可能なファイルでなければならない(空のファイルとかはだめ)
  - **```.template/Makefile``` の ```CC```, ```CFLAGS```, ```PYTHON``` については実行環境によって適宜変更しておくこと**
  - ```python3 contest_scraper.py {contest_name}```
  - {contest_name} はコンテストトップページの URL の最後の部分(abc200 とか)
  - ダウンロード完了後に ```contest_scraper``` を実行したディレクトリに {contest_name} というディレクトリが生成される
  - {contest_name} 以下のディレクトリ構造は下図のよう(B 以降についても B と同様)

.  
├── A  
│   ├── Makefile  
│   ├── sample  
│   │   ├── input1.txt  
│   │   ├── input2.txt  
│   │   ├── output1.txt  
│   │   └── output2.txt  
│   ├── taskA  
│   └── taskA.cc  
├── B  
│   ├── Makefile  
│   ├── sample  
│   │   ├── input1.txt  
│   │   ├── input2.txt  
│   │   ├── input3.txt  
│   │   ├── output1.txt  
│   │   ├── output2.txt  
│   │   └── output3.txt  
│   └── taskB.cc  

  - ```taskA``` はサンプルダウンロード中に並列で ```taskA.cc``` をコンパイルして生成されたもの
    - g++ が RAM に載るようにして初回の ```make test``` (後述)の実行速度を高速化するため 
  - コンテスト全体でなく単一の問題のサンプル入出力をダウンロードしたいときはオプションで ```-p A``` のように指定する
    - このときは事前コンパイルは実行されない
    - ```A``` は大文字でも小文字でも構わない
  - 旧 ABC 等、問題数が 6 問ではないコンテストのサンプル入出力をダウンロードする際はオプションで ```-n 4``` のように指定する
    - 指定しなくてもリクエストのエラーでスクリプトは停止するが、予測可能なエラーをわざわざ出さなくていい

- サンプルのチェック
  - ```task[A-F].cc``` のあるディレクトリで ```make test```

- 提出
  - ```task[A-F].cc``` のあるディレクトリで ```make submit```

- 提出結果の取得
  - ```task[A-F].cc``` のあるディレクトリで ```make status```
  - 最新 5 件の提出結果を見たいときは ```make status | head -n 5``` とかすればよい(Linux の場合)